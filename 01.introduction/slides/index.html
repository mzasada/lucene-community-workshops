<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Introduction to Apache Solr</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/night.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="css/zenburn.css">
</head>

<body>

<div class="reveal">

    <div class="slides">

        <section>
            <h2>Introduction to Apache Solr</h2>

            <h3>Lucene Community</h3>

            <p>Andrzej Wis≈Çowski, Maciej Zasada</p>

            <p>09-01-2014</p>
        </section>

        <section>
            <h1>Agenda</h1>
            <ul>
                <li>Basic concepts
                    <ul>
                        <li>Indexing</li>
                        <li>Searching</li>
                    </ul>
                </li>
                <li>Schema</li>
                <li>Q & A</li>
            </ul>
        </section>

        <section>
            <h2>Indexing</h2>
            <h4>Classes used when indexing documents with Lucene</h4>
            <img src="img/lucene-indexing.svg" alt="Lucene indexing"/>
        </section>

        <section>
            <section>
                <h2>Lucene indexing</h2>
                <h4>Indexing API</h4>
<pre><code data-trim>
    class Indexer implements Closeable {

        IndexWriter indexWriter

        Indexer(File indexLocation) {
            def directory = FSDirectory.open(indexLocation)
            def indexWriterConfig = new IndexWriterConfig(
                Version.LUCENE_46,
                new StandardAnalyzer(Version.LUCENE_46))
            this.indexWriter = new IndexWriter(directory, indexWriterConfig)
        }

        (...)
</code></pre>
            </section>

            <section>
                <h2>Lucene indexing</h2>
                <h4>Document preparation</h4>
<pre><code data-trim>
    private Document prepareDocument(Map&lt;String, Object&gt; fields) {
        new Document().with {
            fields.each {
                key, value -&gt; add(new Field(key, value, TextField.TYPE_STORED))
            }
            it
        }
    }

    (...)
</code></pre>
            </section>

            <section>
                <h2>Lucene indexing</h2>
                <h4>Adding document into index</h4>
<pre><code data-trim>
    void index(Map&lt;String, Object&gt; fields) {
        def document = prepareDocument(fields)
        indexWriter.addDocument(document)
        indexWriter.commit()
    }

    (...)
</code></pre>
            </section>

        </section>

        <!-- Solr Indexing -->

        <section>
            <section>
                <h2>Solr request handling</h2>
                <h4>Dispatcher</h4>
                <img src="img/solr/indexing/SolrDispatchFilter.svg" alt="Solr request handling"/>
            </section>

            <section>
                <h2>Solr request handling</h2>
                <h4>web.xml</h4>
<pre><code data-trim>
&lt;filter&gt;
    &lt;filter-name&gt;SolrRequestFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.apache.solr.servlet.SolrDispatchFilter&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;SolrRequestFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre>
            </section>
        </section>

        <section>
            <section>
                <h2>Solr request handling</h2>
                <h4>Handler lookup</h4>
                <img src="img/solr/indexing/SolrRequestHandler.svg" alt="Handler lookup"/>
            </section>
            <section>
                <h2>Solr request handling</h2>
                <h4>solrconfig.xml</h4>
<pre><code data-trim>
&lt;requestHandler name="/update" class="solr.UpdateRequestHandler"/&gt;
</code></pre>
<pre><code data-trim>
&lt;requestHandler name="/select" class="solr.SearchHandler"&gt;
    &lt;lst name="defaults"&gt;
        &lt;str name="echoParams"&gt;explicit&lt;/str&gt;
        &lt;int name="rows"&gt;10&lt;/int&gt;
        &lt;str name="df"&gt;code&lt;/str&gt;
    &lt;/lst&gt;
&lt;/requestHandler&gt;
</code></pre>
            </section>
        </section>

        <section>
            <h2>Solr indexing</h2>
            <h4>Document preparation</h4>
<pre><code data-trim>
    Map&lt;String,ContentStreamLoader&gt; registry = new HashMap&lt;String,ContentStreamLoader&gt;();
    registry.put("application/xml", new XMLLoader().init(p) );
    registry.put("application/json", new JsonLoader().init(p) );
    registry.put("application/csv", new CSVLoader().init(p) );
    registry.put("application/javabin", new JavabinLoader().init(p) );
    registry.put("text/csv", registry.get("application/csv") );
    registry.put("text/xml", registry.get("application/xml") );
    registry.put("text/json", registry.get("application/json") );
</code></pre>
        </section>

        <section>
            <section>
                <h2>Solr indexing</h2>
                <h4>Update processing</h4>
                <img src="img/solr/indexing/UpdateHandler.svg" alt="Handler lookup"/>
            </section>

            <section>
                <h2>Solr indexing</h2>
                <h4>solrconfig.xml</h4>
<pre><code data-trim>
    &lt;updateRequestProcessorChain name="mychain" default="true"&gt;
        &lt;processor class="solr.CustomUpdateRequestProcessorFactory"&gt;
            &lt;lst name="name"&gt;
                &lt;str name="n1"&gt;x1&lt;/str&gt;
                &lt;str name="n2"&gt;x2&lt;/str&gt;
            &lt;/lst&gt;
        &lt;/processor&gt;
        &lt;processor class="solr.LogUpdateProcessorFactory" /&gt;
        &lt;processor class="solr.RunUpdateProcessorFactory" /&gt;
    &lt;/updateRequestProcessorChain&gt;
</code></pre>
            </section>

            <section>
                <h2>Solr indexing</h2>
                <h4>solrconfig.xml</h4>
<pre><code data-trim>
&lt;updateHandler class="solr.DirectUpdateHandler2"&gt;
    &lt;updateLog&gt;
        &lt;str name="dir"&gt;${solr.ulog.dir:}&lt;/str&gt;
    &lt;/updateLog&gt;
    &lt;autoCommit&gt;
        &lt;maxTime&gt;15000&lt;/maxTime&gt;
        &lt;openSearcher&gt;false&lt;/openSearcher&gt;
    &lt;/autoCommit&gt;
&lt;/updateHandler&gt;
</code></pre>
            </section>

            <section>

            </section>
        </section>

        <section>
            <h1>Q & A</h1>
        </section>

    </div>
</div>

<script src="js/head.min.js"></script>
<script src="js/reveal.min.js"></script>

<script>

    // Full list of configuration options available here:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        minScale: 0.2,
        maxScale: 3.0,

        dependencies: [
            // Syntax highlight for <code> elements
            { src: 'js/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        ]
    });





</script>

</body>
</html>
